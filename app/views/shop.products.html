<div class="row">
    <div id="categoryFilters" ng-controller="CategoryController as categoryCtrl" class="col-md-12">
        <section class="pull-left category-tabs tabs">
            <ul class="nav nav-pills">
                <li ng-class="{ active : saferize(category) == saferize(filters.category) }" ng-repeat="(category, count) in getCategoriesFromProducts(products) | orderBy : category"><!--<a ng-click="setCategory(category, $index)" href>{{category}}</a>-->
                <a category-link>{{category}}</a>
                </li>
                <li ng-show="filteredProducts.length > 0 && filters.category" style="line-height: 2em;left: 5px; margin-right: 7px;"><span style="top: 8px" class="glyphicon glyphicon-chevron-right"></span></li>
            </ul>

        </section>

        <section class="subcategory-tabs category-tabs tabs" style="left: 5px; position: relative; display: inline-block;">
            <ul class="nav nav-pills" ng-show="filteredProducts.length > 0 && filters.category">
                <li ng-class="{ active : saferize(subcategory) == saferize(filters.subcategory)}" ng-repeat="(subcategory, count) in getSubCategoriesFromProducts(filteredProducts)">
                <!--<a ng-click="setsubcategory(subcategory, $index)" href>{{subcategory}}</a>-->
                <a sub-category-link>{{subcategory}}</a></li>
            </ul>
        </section>
    </div>
</div>
<h1>Battlescene Designs<!--<div class="pull-right small"><span class="glyphicon glyphicon-shopping-cart"></span>({{ basket.basketCount() }})</div>--></h1>
<h2 ng-show="products.length > 0 && filteredProducts.length == 0 && filters.searchTerm != ''">Sorry, we have no products that match "{{filters.searchTerm}}"<span ng-show="filters.category"> in the category you have currently selected</span>.</h2>
<section class="bottom-buffer col-sm-6" ng-class="{notlive : !product.live }" ng-repeat="product in (filteredProducts = (products | filter : search))">
    <div class="row" ng-show="userService.currentUser">
        <a ng-click="toggleEdit(product.$id)" class="pull-right edit"></a>
        <a ng-show="canEdit(product.$id)" ng-click="save(product)" class="pull-right save"></a>
        <a ng-show="canEdit(product.$id)" ng-click="delete(product)" class="delete pull-right"><span class="glyphicon glyphicon-trash"></span></a>
    </div>
    <div class="col-sm-4">
        <a href ui-sref="shop.product({productId: product.$id})" ng-repeat="image in product.images | obj2Arr | limitTo: 1" class="product-image-container">
            <img fb-src="{{ image.filename }}" data-src="{{ image.data }}" class="img-responsive"/>
        </a>
    </div>
    <div class="col-sm-8">
        <div class="form-group" ng-show="canEdit(product.$id)">
                <select ng-model="product.category">
                    <option ng-repeat="category in categories" value="{{category.name}}" ng-selected="category.name == product.category">{{category.name}}</option>
                </select>
                <select ng-model="product.subcategory">
                <option value=""> -- Select a subcategory -- </option>
                <option ng-repeat="subcategory in getSubCategories(product.category)" value="{{subcategory.name}}" ng-selected="subcategory.name == product.subcategory">{{subcategory.name}}</option>
            </select>
        </div>
        <h3 ng-show="!canEdit(product.$id)"><a href ui-sref="shop.product({productId: product.$id})">{{ product.name }}</a></h3>
        <input ng-show="canEdit(product.$id)" class="titleInput" ng-model="product.name" size="50" type="text"/>
        <div ng-show="!canEdit(product.$id)" class="description">
        <p>
        {{product.description}}
        </p>
        </div>
        <div ng-show="!canEdit(product.$id)" class="price-qty">{{product.qty}} per pack <em ng-show="product.dimensions">(approx {{product.dimensions}})</em><em class="pull-right">&nbsp;- {{ product.price | currency : "&pound;" }}</em></div>
        <textarea class="description" cols="55" ng-show="canEdit(product.$id)" ng-model="product.description">{{product.description}}</textarea>
        <div ng-show="canEdit(product.$id)" class="form-group price-qty">
        <div class="form-group"><input size="2" type="text" ng-model="product.qty"/> per pack
        </div>
        <div class="form-group">(approx <input type="text" ng-model="product.dimensions" size="4"/>) - Â£<input size="2" class="pull-right" ng-model="product.price"/></div>
        <div class="checkbox">
            <label ng-show="canEdit(product.$id)" for="live"><input type="checkbox" ng-model="product.live" name="live"/>Live</label>
        </div>
    </div>
    <!--<button ng-click="basket.addToBasket(product)">Add to Basket</button>-->
</section>